\hypertarget{mesh__parser_8h_source}{}\doxysection{mesh\+\_\+parser.\+h}
\label{mesh__parser_8h_source}\index{tesseract\_geometry/include/tesseract\_geometry/mesh\_parser.h@{tesseract\_geometry/include/tesseract\_geometry/mesh\_parser.h}}
\mbox{\hyperlink{mesh__parser_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*********************************************************************}}
\DoxyCodeLine{2 \textcolor{comment}{ * Software License Agreement (BSD License)}}
\DoxyCodeLine{3 \textcolor{comment}{ *}}
\DoxyCodeLine{4 \textcolor{comment}{ *  Copyright (c) 2008, Willow Garage, Inc.}}
\DoxyCodeLine{5 \textcolor{comment}{ *  All rights reserved.}}
\DoxyCodeLine{6 \textcolor{comment}{ *}}
\DoxyCodeLine{7 \textcolor{comment}{ *  Redistribution and use in source and binary forms, with or without}}
\DoxyCodeLine{8 \textcolor{comment}{ *  modification, are permitted provided that the following conditions}}
\DoxyCodeLine{9 \textcolor{comment}{ *  are met:}}
\DoxyCodeLine{10 \textcolor{comment}{ *}}
\DoxyCodeLine{11 \textcolor{comment}{ *   * Redistributions of source code must retain the above copyright}}
\DoxyCodeLine{12 \textcolor{comment}{ *     notice, this list of conditions and the following disclaimer.}}
\DoxyCodeLine{13 \textcolor{comment}{ *   * Redistributions in binary form must reproduce the above}}
\DoxyCodeLine{14 \textcolor{comment}{ *     copyright notice, this list of conditions and the following}}
\DoxyCodeLine{15 \textcolor{comment}{ *     disclaimer in the documentation and/or other materials provided}}
\DoxyCodeLine{16 \textcolor{comment}{ *     with the distribution.}}
\DoxyCodeLine{17 \textcolor{comment}{ *   * Neither the name of the Willow Garage nor the names of its}}
\DoxyCodeLine{18 \textcolor{comment}{ *     contributors may be used to endorse or promote products derived}}
\DoxyCodeLine{19 \textcolor{comment}{ *     from this software without specific prior written permission.}}
\DoxyCodeLine{20 \textcolor{comment}{ *}}
\DoxyCodeLine{21 \textcolor{comment}{ *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS}}
\DoxyCodeLine{22 \textcolor{comment}{ *  "{}AS IS"{} AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT}}
\DoxyCodeLine{23 \textcolor{comment}{ *  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS}}
\DoxyCodeLine{24 \textcolor{comment}{ *  FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE}}
\DoxyCodeLine{25 \textcolor{comment}{ *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,}}
\DoxyCodeLine{26 \textcolor{comment}{ *  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,}}
\DoxyCodeLine{27 \textcolor{comment}{ *  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;}}
\DoxyCodeLine{28 \textcolor{comment}{ *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER}}
\DoxyCodeLine{29 \textcolor{comment}{ *  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT}}
\DoxyCodeLine{30 \textcolor{comment}{ *  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN}}
\DoxyCodeLine{31 \textcolor{comment}{ *  ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE}}
\DoxyCodeLine{32 \textcolor{comment}{ *  POSSIBILITY OF SUCH DAMAGE.}}
\DoxyCodeLine{33 \textcolor{comment}{ *********************************************************************/}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{comment}{/* Author: Ioan Sucan */}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{comment}{/* Updated by John Wason, Wason Technology, LLC, Dec 2020. Add loading mesh normals,}}
\DoxyCodeLine{38 \textcolor{comment}{   materials, and textures */}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40 \textcolor{preprocessor}{\#ifndef TESSERACT\_SCENE\_GRAPH\_MESH\_PARSER\_H}}
\DoxyCodeLine{41 \textcolor{preprocessor}{\#define TESSERACT\_SCENE\_GRAPH\_MESH\_PARSER\_H}}
\DoxyCodeLine{42 }
\DoxyCodeLine{43 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{macros_8h}{tesseract\_common/macros.h}}>}}
\DoxyCodeLine{44 \mbox{\hyperlink{macros_8h_a8cc0e3c6a3382c5c0b19eb9e676fc2db}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{preprocessor}{\#include <assimp/scene.h>}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#include <assimp/Importer.hpp>}}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#include <assimp/postprocess.h>}}
\DoxyCodeLine{50 }
\DoxyCodeLine{51 \textcolor{preprocessor}{\#ifdef TESSERACT\_ASSIMP\_USE\_PBRMATERIAL}}
\DoxyCodeLine{52 \textcolor{preprocessor}{\#include <assimp/pbrmaterial.h>}}
\DoxyCodeLine{53 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{preprocessor}{\#include <console\_bridge/console.h>}}
\DoxyCodeLine{56 }
\DoxyCodeLine{57 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{tesseract__common_2include_2tesseract__common_2types_8h}{tesseract\_common/types.h}}>}}
\DoxyCodeLine{58 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{resource__locator_8h}{tesseract\_common/resource\_locator.h}}>}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{preprocessor}{\#include <regex>}}
\DoxyCodeLine{61 \textcolor{preprocessor}{\#include <boost/filesystem/path.hpp>}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \mbox{\hyperlink{namespaceTESSERACT__COMMON__IGNORE__WARNINGS__POP}{TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{mesh__material_8h}{tesseract\_geometry/impl/mesh\_material.h}}>}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__geometry}{tesseract\_geometry}}}
\DoxyCodeLine{68 \{}
\DoxyCodeLine{75 \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{76 std::vector<std::shared\_ptr<T>> \mbox{\hyperlink{namespacetesseract__geometry_a5a3fd49b971eb1975a812703e0a08932}{extractMeshData}}(\textcolor{keyword}{const} aiScene* scene,}
\DoxyCodeLine{77                                                 \textcolor{keyword}{const} aiNode* node,}
\DoxyCodeLine{78                                                 \textcolor{keyword}{const} aiMatrix4x4\& parent\_transform,}
\DoxyCodeLine{79                                                 \textcolor{keyword}{const} Eigen::Vector3d\& \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}},}
\DoxyCodeLine{80                                                 \mbox{\hyperlink{classtesseract__common_1_1Resource_acdba916fa227bef4391c469581844dc6}{tesseract\_common::Resource::Ptr}} \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}},}
\DoxyCodeLine{81                                                 \textcolor{keywordtype}{bool} normals,}
\DoxyCodeLine{82                                                 \textcolor{keywordtype}{bool} vertex\_colors,}
\DoxyCodeLine{83                                                 \textcolor{keywordtype}{bool} material\_and\_texture)}
\DoxyCodeLine{84 \{}
\DoxyCodeLine{85   std::vector<std::shared\_ptr<T>> \mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}};}
\DoxyCodeLine{86   \mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}}.reserve(node-\/>mNumMeshes);}
\DoxyCodeLine{87 }
\DoxyCodeLine{88   aiMatrix4x4 \mbox{\hyperlink{collision__core__unit_8cpp_a0711277889ece6b8e49c8ad05d361167}{transform}} = parent\_transform;}
\DoxyCodeLine{89   \mbox{\hyperlink{collision__core__unit_8cpp_a0711277889ece6b8e49c8ad05d361167}{transform}} *= node-\/>mTransformation;}
\DoxyCodeLine{90   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}} = 0; \mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}} < node-\/>mNumMeshes; ++\mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}})}
\DoxyCodeLine{91   \{}
\DoxyCodeLine{92     \textcolor{keyword}{auto} vertices = std::make\_shared<tesseract\_common::VectorVector3d>();}
\DoxyCodeLine{93     \textcolor{keyword}{auto} triangles = std::make\_shared<Eigen::VectorXi>();}
\DoxyCodeLine{94     std::shared\_ptr<tesseract\_common::VectorVector3d> vertex\_normals = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{95     std::shared\_ptr<tesseract\_common::VectorVector4d> vertex\_colors = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{96     \mbox{\hyperlink{classtesseract__geometry_1_1MeshMaterial_ad67358c38f5044f5759070974ec73e54}{MeshMaterial::Ptr}} \mbox{\hyperlink{tesseract__scene__graph__link__unit_8cpp_abd1ae0faf8b8ed36ee5c62dd1c259a59}{material}} = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{97     std::shared\_ptr<std::vector<MeshTexture::Ptr>> textures = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{98 }
\DoxyCodeLine{99     \textcolor{keyword}{const} aiMesh* a = scene-\/>mMeshes[node-\/>mMeshes[\mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}}]];}
\DoxyCodeLine{100     vertices-\/>reserve(a-\/>mNumVertices);}
\DoxyCodeLine{101     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < a-\/>mNumVertices; ++i)}
\DoxyCodeLine{102     \{}
\DoxyCodeLine{103       aiVector3D \mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}} = \mbox{\hyperlink{collision__core__unit_8cpp_a0711277889ece6b8e49c8ad05d361167}{transform}} * a-\/>mVertices[i];}
\DoxyCodeLine{104       vertices-\/>push\_back(Eigen::Vector3d(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.x) * \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}(0),}
\DoxyCodeLine{105                                           \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.y) * \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}(1),}
\DoxyCodeLine{106                                           \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.z) * \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}(2)));}
\DoxyCodeLine{107     \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109     \textcolor{keywordtype}{long} triangle\_count = 0;}
\DoxyCodeLine{110     std::vector<int> local\_triangles;}
\DoxyCodeLine{111     local\_triangles.reserve(a-\/>mNumFaces);}
\DoxyCodeLine{112     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < a-\/>mNumFaces; ++i)}
\DoxyCodeLine{113     \{}
\DoxyCodeLine{114       \textcolor{keywordflow}{if} (a-\/>mFaces[i].mNumIndices >= 3)}
\DoxyCodeLine{115       \{}
\DoxyCodeLine{116         triangle\_count += 1;}
\DoxyCodeLine{117         local\_triangles.push\_back(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(a-\/>mFaces[i].mNumIndices));}
\DoxyCodeLine{118         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} k = 0; k < a-\/>mFaces[i].mNumIndices; ++k)}
\DoxyCodeLine{119           local\_triangles.push\_back(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(a-\/>mFaces[i].mIndices[k]));}
\DoxyCodeLine{120       \}}
\DoxyCodeLine{121       \textcolor{keywordflow}{else}}
\DoxyCodeLine{122       \{}
\DoxyCodeLine{123         CONSOLE\_BRIDGE\_logDebug(\textcolor{stringliteral}{"{}Mesh had a face with less than three vertices: \%s"{}}, \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>getUrl().c\_str());}
\DoxyCodeLine{124       \}}
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     triangles-\/>resize(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\textcolor{keyword}{>}(local\_triangles.size()));}
\DoxyCodeLine{128     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{long} i = 0; i < triangles-\/>size(); ++i)}
\DoxyCodeLine{129       (*triangles)[i] = local\_triangles[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(i)];}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \textcolor{keywordflow}{if} (normals \&\& a-\/>HasNormals())}
\DoxyCodeLine{132     \{}
\DoxyCodeLine{133       vertex\_normals = std::make\_shared<tesseract\_common::VectorVector3d>();}
\DoxyCodeLine{134       vertex\_normals-\/>reserve(a-\/>mNumVertices);}
\DoxyCodeLine{135       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < a-\/>mNumVertices; ++i)}
\DoxyCodeLine{136       \{}
\DoxyCodeLine{137         aiVector3D \mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}} = \mbox{\hyperlink{collision__core__unit_8cpp_a0711277889ece6b8e49c8ad05d361167}{transform}} * a-\/>mNormals[i];}
\DoxyCodeLine{138         vertex\_normals-\/>push\_back(Eigen::Vector3d(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.x) * \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}(0),}
\DoxyCodeLine{139                                                   \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.y) * \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}(1),}
\DoxyCodeLine{140                                                   \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.z) * \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}(2)));}
\DoxyCodeLine{141       \}}
\DoxyCodeLine{142     \}}
\DoxyCodeLine{143 }
\DoxyCodeLine{144     \textcolor{keywordflow}{if} (vertex\_colors \&\& a-\/>HasVertexColors(0))}
\DoxyCodeLine{145     \{}
\DoxyCodeLine{146       vertex\_colors = std::make\_shared<tesseract\_common::VectorVector4d>();}
\DoxyCodeLine{147       vertex\_colors-\/>reserve(a-\/>mNumVertices);}
\DoxyCodeLine{148       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < a-\/>mNumVertices; ++i)}
\DoxyCodeLine{149       \{}
\DoxyCodeLine{150         aiColor4D \mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}} = a-\/>mColors[0][i];}
\DoxyCodeLine{151         vertex\_colors-\/>push\_back(Eigen::Vector4d(}
\DoxyCodeLine{152             \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.r), \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.g), \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.b), \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.a)));}
\DoxyCodeLine{153       \}}
\DoxyCodeLine{154     \}}
\DoxyCodeLine{155 }
\DoxyCodeLine{156     \textcolor{keywordflow}{if} (material\_and\_texture)}
\DoxyCodeLine{157     \{}
\DoxyCodeLine{158       aiMaterial* mat = scene-\/>mMaterials[a-\/>mMaterialIndex];}
\DoxyCodeLine{159       \{}
\DoxyCodeLine{160         Eigen::Vector4d base\_color;}
\DoxyCodeLine{161         \textcolor{keywordtype}{double} metallic = 0.0;}
\DoxyCodeLine{162         \textcolor{keywordtype}{double} roughness = 0.5;}
\DoxyCodeLine{163         Eigen::Vector4d emissive;}
\DoxyCodeLine{164 }
\DoxyCodeLine{165         aiColor4D pbr\_base\_color;}
\DoxyCodeLine{166 \textcolor{preprocessor}{\#ifdef TESSERACT\_ASSIMP\_USE\_PBRMATERIAL}}
\DoxyCodeLine{167         \textcolor{keywordflow}{if} (mat-\/>Get(AI\_MATKEY\_GLTF\_PBRMETALLICROUGHNESS\_BASE\_COLOR\_FACTOR, pbr\_base\_color) == AI\_SUCCESS)}
\DoxyCodeLine{168         \{}
\DoxyCodeLine{169           \textcolor{comment}{// Use PBR Metallic material properties if available}}
\DoxyCodeLine{170           base\_color = Eigen::Vector4d(pbr\_base\_color.r, pbr\_base\_color.g, pbr\_base\_color.b, pbr\_base\_color.a);}
\DoxyCodeLine{171           \textcolor{keywordtype}{float} metallicFactor\{ 0 \};}
\DoxyCodeLine{172           \textcolor{keywordflow}{if} (mat-\/>Get(AI\_MATKEY\_GLTF\_PBRMETALLICROUGHNESS\_METALLIC\_FACTOR, metallicFactor) == AI\_SUCCESS)}
\DoxyCodeLine{173           \{}
\DoxyCodeLine{174             metallic = metallicFactor;}
\DoxyCodeLine{175           \}}
\DoxyCodeLine{176           \textcolor{keywordtype}{float} roughnessFactor\{ 0.5 \};}
\DoxyCodeLine{177           \textcolor{keywordflow}{if} (mat-\/>Get(AI\_MATKEY\_GLTF\_PBRMETALLICROUGHNESS\_ROUGHNESS\_FACTOR, roughnessFactor) == AI\_SUCCESS)}
\DoxyCodeLine{178           \{}
\DoxyCodeLine{179             roughness = roughnessFactor;}
\DoxyCodeLine{180           \}}
\DoxyCodeLine{181           aiColor4D pbr\_emissive\_color;}
\DoxyCodeLine{182           \textcolor{keywordflow}{if} (mat-\/>Get(AI\_MATKEY\_COLOR\_EMISSIVE, pbr\_emissive\_color) == AI\_SUCCESS)}
\DoxyCodeLine{183           \{}
\DoxyCodeLine{184             emissive =}
\DoxyCodeLine{185                 Eigen::Vector4d(pbr\_emissive\_color.r, pbr\_emissive\_color.g, pbr\_emissive\_color.b, pbr\_emissive\_color.a);}
\DoxyCodeLine{186           \}}
\DoxyCodeLine{187         \}}
\DoxyCodeLine{188         \textcolor{keywordflow}{else}}
\DoxyCodeLine{189 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{190         \{}
\DoxyCodeLine{191           \textcolor{comment}{// Use old style material. Ambient and specular not supported}}
\DoxyCodeLine{192           aiColor4D diffuse\_color;}
\DoxyCodeLine{193           \textcolor{keywordflow}{if} (mat-\/>Get(AI\_MATKEY\_COLOR\_DIFFUSE, diffuse\_color) == AI\_SUCCESS)}
\DoxyCodeLine{194           \{}
\DoxyCodeLine{195             base\_color = Eigen::Vector4d(diffuse\_color.r, diffuse\_color.g, diffuse\_color.b, diffuse\_color.a);}
\DoxyCodeLine{196           \}}
\DoxyCodeLine{197 }
\DoxyCodeLine{198           aiColor4D emissive\_color;}
\DoxyCodeLine{199           \textcolor{keywordflow}{if} (mat-\/>Get(AI\_MATKEY\_COLOR\_EMISSIVE, emissive\_color) == AI\_SUCCESS)}
\DoxyCodeLine{200           \{}
\DoxyCodeLine{201             emissive = Eigen::Vector4d(emissive\_color.r, emissive\_color.g, emissive\_color.b, emissive\_color.a);}
\DoxyCodeLine{202           \}}
\DoxyCodeLine{203         \}}
\DoxyCodeLine{204 }
\DoxyCodeLine{205         \mbox{\hyperlink{tesseract__scene__graph__link__unit_8cpp_abd1ae0faf8b8ed36ee5c62dd1c259a59}{material}} = std::make\_shared<MeshMaterial>(base\_color, metallic, roughness, emissive);}
\DoxyCodeLine{206 }
\DoxyCodeLine{207         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < a-\/>GetNumUVChannels(); i++)}
\DoxyCodeLine{208         \{}
\DoxyCodeLine{209           \textcolor{keywordflow}{if} (a-\/>HasTextureCoords(i))}
\DoxyCodeLine{210           \{}
\DoxyCodeLine{211             aiString texName;}
\DoxyCodeLine{212             aiTextureMapping mapping\{ aiTextureMapping\_OTHER \};}
\DoxyCodeLine{213             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} uvIndex\{ 0 \};}
\DoxyCodeLine{214             \textcolor{keywordflow}{if} (mat-\/>GetTexture(aiTextureType\_DIFFUSE, i, \&texName, \&mapping, \&uvIndex) == AI\_SUCCESS)}
\DoxyCodeLine{215             \{}
\DoxyCodeLine{216               \mbox{\hyperlink{classtesseract__common_1_1Resource_acdba916fa227bef4391c469581844dc6}{tesseract\_common::Resource::Ptr}} texture\_image;}
\DoxyCodeLine{217               \mbox{\hyperlink{namespacetesseract__common_ac60e1af30f961fc086b69e330c6434d4}{tesseract\_common::VectorVector2d}} uvs;}
\DoxyCodeLine{218               \textcolor{comment}{// https://stackoverflow.com/questions/56820244/assimp-\/doenst-\/return-\/texture-\/data}}
\DoxyCodeLine{219               \textcolor{keyword}{const} \textcolor{keywordtype}{char}* texNamec = texName.C\_Str();}
\DoxyCodeLine{220               \textcolor{keywordflow}{if} (\textcolor{charliteral}{'*'} == *texNamec)}
\DoxyCodeLine{221               \{}
\DoxyCodeLine{222                 \textcolor{keywordtype}{int} tex\_index = std::atoi(texNamec + 1);}
\DoxyCodeLine{223                 \textcolor{keywordflow}{if} (0 > tex\_index || scene-\/>mNumTextures <= \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{unsigned}\textcolor{keyword}{>}(tex\_index))}
\DoxyCodeLine{224                   \textcolor{keywordflow}{continue};}
\DoxyCodeLine{225                 \textcolor{keyword}{auto}* texture\_data = scene-\/>mTextures[tex\_index];}
\DoxyCodeLine{226                 \textcolor{comment}{// returned pointer is not null, read texture from memory}}
\DoxyCodeLine{227                 std::string file\_type = texture\_data-\/>achFormatHint;}
\DoxyCodeLine{228                 \textcolor{keywordflow}{if} (file\_type == \textcolor{stringliteral}{"{}jpg"{}} || file\_type == \textcolor{stringliteral}{"{}png"{}})}
\DoxyCodeLine{229                 \{}
\DoxyCodeLine{230                   texture\_image = std::make\_shared<tesseract\_common::BytesResource>(}
\DoxyCodeLine{231                       \textcolor{stringliteral}{"{}data://"{}}, (\textcolor{keyword}{const} uint8\_t*)texture\_data-\/>pcData, texture\_data-\/>mWidth);  \textcolor{comment}{// NOLINT}}
\DoxyCodeLine{232                 \}}
\DoxyCodeLine{233                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{234                 \{}
\DoxyCodeLine{235                   \textcolor{comment}{// TODO: handle other file types}}
\DoxyCodeLine{236                   \textcolor{keywordflow}{continue};}
\DoxyCodeLine{237                 \}}
\DoxyCodeLine{238               \}}
\DoxyCodeLine{239               \textcolor{keywordflow}{else}}
\DoxyCodeLine{240               \{}
\DoxyCodeLine{241                 \textcolor{keywordflow}{if} (!\mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}})}
\DoxyCodeLine{242                 \{}
\DoxyCodeLine{243                   \textcolor{keywordflow}{continue};}
\DoxyCodeLine{244                 \}}
\DoxyCodeLine{245                 std::string texName\_str(texName.C\_Str());}
\DoxyCodeLine{246                 \textcolor{keyword}{auto} tex\_resource = \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>locateResource(texName\_str);}
\DoxyCodeLine{247                 \textcolor{keywordflow}{if} (!tex\_resource)}
\DoxyCodeLine{248                 \{}
\DoxyCodeLine{249                   \textcolor{keywordflow}{continue};}
\DoxyCodeLine{250                 \}}
\DoxyCodeLine{251                 texture\_image = tex\_resource;}
\DoxyCodeLine{252               \}}
\DoxyCodeLine{253               aiVector3D* tex\_coords = a-\/>mTextureCoords[i];}
\DoxyCodeLine{254               \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}} = 0; \mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}} < a-\/>mNumVertices; ++\mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}})}
\DoxyCodeLine{255               \{}
\DoxyCodeLine{256                 aiVector3D \mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}} = tex\_coords[\mbox{\hyperlink{tesseract__scene__graph__joint__unit_8cpp_aa1fb310d8ace4891c0b2e65083602936}{j}}];}
\DoxyCodeLine{257                 uvs.push\_back(Eigen::Vector2d(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.x), \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(\mbox{\hyperlink{tesseract__common__unit_8cpp_ac4055e3a20b6b3af3d10590ea446ef6c}{v}}.y)));}
\DoxyCodeLine{258               \}}
\DoxyCodeLine{259               \textcolor{keyword}{auto} tex = std::make\_shared<MeshTexture>(}
\DoxyCodeLine{260                   texture\_image, std::make\_shared<tesseract\_common::VectorVector2d>(std::move(uvs)));}
\DoxyCodeLine{261               \textcolor{keywordflow}{if} (!textures)}
\DoxyCodeLine{262               \{}
\DoxyCodeLine{263                 textures = std::make\_shared<std::vector<MeshTexture::Ptr>>();}
\DoxyCodeLine{264               \}}
\DoxyCodeLine{265               textures-\/>push\_back(tex);}
\DoxyCodeLine{266             \}}
\DoxyCodeLine{267           \}}
\DoxyCodeLine{268         \}}
\DoxyCodeLine{269       \}}
\DoxyCodeLine{270     \}}
\DoxyCodeLine{271 }
\DoxyCodeLine{272     \mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}}.push\_back(std::make\_shared<T>(vertices,}
\DoxyCodeLine{273                                          triangles,}
\DoxyCodeLine{274                                          \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(triangle\_count),}
\DoxyCodeLine{275                                          \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}},}
\DoxyCodeLine{276                                          \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}},}
\DoxyCodeLine{277                                          vertex\_normals,}
\DoxyCodeLine{278                                          vertex\_colors,}
\DoxyCodeLine{279                                          \mbox{\hyperlink{tesseract__scene__graph__link__unit_8cpp_abd1ae0faf8b8ed36ee5c62dd1c259a59}{material}},}
\DoxyCodeLine{280                                          textures));}
\DoxyCodeLine{281   \}}
\DoxyCodeLine{282 }
\DoxyCodeLine{283   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = 0; n < node-\/>mNumChildren; ++n)}
\DoxyCodeLine{284   \{}
\DoxyCodeLine{285     std::vector<std::shared\_ptr<T>> child\_meshes = extractMeshData<T>(}
\DoxyCodeLine{286         scene, node-\/>mChildren[n], \mbox{\hyperlink{collision__core__unit_8cpp_a0711277889ece6b8e49c8ad05d361167}{transform}}, \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}, \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}, normals, vertex\_colors, material\_and\_texture);}
\DoxyCodeLine{287     \mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}}.insert(\mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}}.end(), child\_meshes.begin(), child\_meshes.end());}
\DoxyCodeLine{288   \}}
\DoxyCodeLine{289   \textcolor{keywordflow}{return} \mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}};}
\DoxyCodeLine{290 \}}
\DoxyCodeLine{291 }
\DoxyCodeLine{302 \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{303 std::vector<std::shared\_ptr<T>> \mbox{\hyperlink{namespacetesseract__geometry_a3a51378812ee2449279ff9c385db91fc}{createMeshFromAsset}}(\textcolor{keyword}{const} aiScene* scene,}
\DoxyCodeLine{304                                                     \textcolor{keyword}{const} Eigen::Vector3d\& \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}},}
\DoxyCodeLine{305                                                     \mbox{\hyperlink{classtesseract__common_1_1Resource_acdba916fa227bef4391c469581844dc6}{tesseract\_common::Resource::Ptr}} \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}},}
\DoxyCodeLine{306                                                     \textcolor{keywordtype}{bool} normals,}
\DoxyCodeLine{307                                                     \textcolor{keywordtype}{bool} vertex\_colors,}
\DoxyCodeLine{308                                                     \textcolor{keywordtype}{bool} material\_and\_texture)}
\DoxyCodeLine{309 \{}
\DoxyCodeLine{310   \textcolor{keywordflow}{if} (!scene-\/>HasMeshes())}
\DoxyCodeLine{311   \{}
\DoxyCodeLine{312     CONSOLE\_BRIDGE\_logWarn(\textcolor{stringliteral}{"{}Assimp reports scene in \%s has no meshes"{}}, \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>getUrl().c\_str());}
\DoxyCodeLine{313     \textcolor{keywordflow}{return} std::vector<std::shared\_ptr<T>>();}
\DoxyCodeLine{314   \}}
\DoxyCodeLine{315   std::vector<std::shared\_ptr<T>> \mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}} = extractMeshData<T>(}
\DoxyCodeLine{316       scene, scene-\/>mRootNode, aiMatrix4x4(), \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}, \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}, normals, vertex\_colors, material\_and\_texture);}
\DoxyCodeLine{317   \textcolor{keywordflow}{if} (\mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}}.empty())}
\DoxyCodeLine{318   \{}
\DoxyCodeLine{319     CONSOLE\_BRIDGE\_logWarn(\textcolor{stringliteral}{"{}There are no meshes in the scene \%s"{}}, \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>getUrl().c\_str());}
\DoxyCodeLine{320     \textcolor{keywordflow}{return} std::vector<std::shared\_ptr<T>>();}
\DoxyCodeLine{321   \}}
\DoxyCodeLine{322 }
\DoxyCodeLine{323   \textcolor{keywordflow}{return} \mbox{\hyperlink{tesseract__geometry__unit_8cpp_a5428deecfa188d28deb2a96fe29066e8}{meshes}};}
\DoxyCodeLine{324 \}}
\DoxyCodeLine{325 }
\DoxyCodeLine{339 \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{340 std::vector<std::shared\_ptr<T>> \mbox{\hyperlink{namespacetesseract__geometry_a1b4cdf1aee6142e3870f87d2d9a9c931}{createMeshFromPath}}(\textcolor{keyword}{const} std::string\& path,}
\DoxyCodeLine{341                                                    Eigen::Vector3d \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}} = Eigen::Vector3d(1, 1, 1),}
\DoxyCodeLine{342                                                    \textcolor{keywordtype}{bool} triangulate = \textcolor{keyword}{false},}
\DoxyCodeLine{343                                                    \textcolor{keywordtype}{bool} flatten = \textcolor{keyword}{false},}
\DoxyCodeLine{344                                                    \textcolor{keywordtype}{bool} normals = \textcolor{keyword}{false},}
\DoxyCodeLine{345                                                    \textcolor{keywordtype}{bool} vertex\_colors = \textcolor{keyword}{false},}
\DoxyCodeLine{346                                                    \textcolor{keywordtype}{bool} material\_and\_texture = \textcolor{keyword}{false})}
\DoxyCodeLine{347 \{}
\DoxyCodeLine{348   \textcolor{comment}{// Create an instance of the Importer class}}
\DoxyCodeLine{349   Assimp::Importer importer;}
\DoxyCodeLine{350 }
\DoxyCodeLine{351   \textcolor{comment}{// Issue \#38 fix: as part of the post-\/processing, we remove all other components in file but}}
\DoxyCodeLine{352   \textcolor{comment}{// the meshes, as anyway the resulting shapes:Mesh object just receives vertices and triangles.}}
\DoxyCodeLine{353   \textcolor{comment}{// John Wason Jan 2021 -\/ Adjust flags based on normals, vertex\_colors, and material\_and\_texture parameters}}
\DoxyCodeLine{354   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ai\_config\_pp\_rcv\_flags = aiComponent\_TANGENTS\_AND\_BITANGENTS | aiComponent\_BONEWEIGHTS |}
\DoxyCodeLine{355                                         aiComponent\_ANIMATIONS | aiComponent\_LIGHTS | aiComponent\_CAMERAS;}
\DoxyCodeLine{356   \textcolor{keywordflow}{if} (!normals)}
\DoxyCodeLine{357   \{}
\DoxyCodeLine{358     ai\_config\_pp\_rcv\_flags |= aiComponent\_NORMALS;}
\DoxyCodeLine{359   \}}
\DoxyCodeLine{360   \textcolor{keywordflow}{if} (!vertex\_colors)}
\DoxyCodeLine{361   \{}
\DoxyCodeLine{362     ai\_config\_pp\_rcv\_flags |= aiComponent\_COLORS;}
\DoxyCodeLine{363   \}}
\DoxyCodeLine{364   \textcolor{keywordflow}{if} (!material\_and\_texture)}
\DoxyCodeLine{365   \{}
\DoxyCodeLine{366     ai\_config\_pp\_rcv\_flags |= aiComponent\_TEXCOORDS | aiComponent\_TEXTURES | aiComponent\_MATERIALS;}
\DoxyCodeLine{367   \}}
\DoxyCodeLine{368   importer.SetPropertyInteger(AI\_CONFIG\_PP\_RVC\_FLAGS, (\textcolor{keywordtype}{int})ai\_config\_pp\_rcv\_flags);}
\DoxyCodeLine{369 }
\DoxyCodeLine{370   \textcolor{comment}{// And have it read the given file with some post-\/processing}}
\DoxyCodeLine{371   \textcolor{keyword}{const} aiScene* scene = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{372   \textcolor{keywordflow}{if} (triangulate)}
\DoxyCodeLine{373     scene = importer.ReadFile(\mbox{\hyperlink{tesseract__srdf__unit_8cpp_a4f0c2c1ddd740994eb90524a8d086dca}{path}}.c\_str(),}
\DoxyCodeLine{374                               aiProcess\_Triangulate | aiProcess\_JoinIdenticalVertices | aiProcess\_SortByPType |}
\DoxyCodeLine{375                                   aiProcess\_RemoveComponent);}
\DoxyCodeLine{376   \textcolor{keywordflow}{else}}
\DoxyCodeLine{377     scene = importer.ReadFile(\mbox{\hyperlink{tesseract__srdf__unit_8cpp_a4f0c2c1ddd740994eb90524a8d086dca}{path}}.c\_str(),}
\DoxyCodeLine{378                               aiProcess\_JoinIdenticalVertices | aiProcess\_SortByPType | aiProcess\_RemoveComponent);}
\DoxyCodeLine{379 }
\DoxyCodeLine{380   \textcolor{keywordflow}{if} (!scene)}
\DoxyCodeLine{381   \{}
\DoxyCodeLine{382     CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}Could not load mesh from \(\backslash\)"{}\%s\(\backslash\)"{}: \%s"{}}, \mbox{\hyperlink{tesseract__srdf__unit_8cpp_a4f0c2c1ddd740994eb90524a8d086dca}{path}}.c\_str(), importer.GetErrorString());}
\DoxyCodeLine{383     \textcolor{keywordflow}{return} std::vector<std::shared\_ptr<T>>();}
\DoxyCodeLine{384   \}}
\DoxyCodeLine{385 }
\DoxyCodeLine{386   \textcolor{comment}{// Assimp enforces Y\_UP convention by rotating models with different conventions.}}
\DoxyCodeLine{387   \textcolor{comment}{// However, that behavior is confusing and doesn't match the ROS convention}}
\DoxyCodeLine{388   \textcolor{comment}{// where the Z axis is pointing up.}}
\DoxyCodeLine{389   \textcolor{comment}{// Hopefully this doesn't undo legit use of the root node transformation...}}
\DoxyCodeLine{390   \textcolor{comment}{// Note that this is also what RViz does internally.}}
\DoxyCodeLine{391   \textcolor{comment}{// @todo See this issue for possible fix parsing scene metadata https://github.com/assimp/assimp/issues/849}}
\DoxyCodeLine{392   scene-\/>mRootNode-\/>mTransformation = aiMatrix4x4();}
\DoxyCodeLine{393 }
\DoxyCodeLine{394   \textcolor{keywordflow}{if} (flatten)}
\DoxyCodeLine{395   \{}
\DoxyCodeLine{396     \textcolor{comment}{// These post processing steps flatten the root node transformation into child nodes,}}
\DoxyCodeLine{397     \textcolor{comment}{// so they must be delayed until after clearing the root node transform above.}}
\DoxyCodeLine{398     importer.ApplyPostProcessing(aiProcess\_OptimizeMeshes | aiProcess\_OptimizeGraph);}
\DoxyCodeLine{399   \}}
\DoxyCodeLine{400   \textcolor{keywordflow}{else}}
\DoxyCodeLine{401   \{}
\DoxyCodeLine{402     importer.ApplyPostProcessing(aiProcess\_OptimizeGraph);}
\DoxyCodeLine{403   \}}
\DoxyCodeLine{404 }
\DoxyCodeLine{405   \textcolor{keywordflow}{return} createMeshFromAsset<T>(scene, \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}, \textcolor{keyword}{nullptr}, normals, vertex\_colors, material\_and\_texture);}
\DoxyCodeLine{406 \}}
\DoxyCodeLine{407 }
\DoxyCodeLine{421 \textcolor{keyword}{template} <\textcolor{keyword}{class} T>}
\DoxyCodeLine{422 std::vector<std::shared\_ptr<T>> \mbox{\hyperlink{namespacetesseract__geometry_ac1c4aaf2f6dc8a3872ea2af8b905948c}{createMeshFromResource}}(\mbox{\hyperlink{classtesseract__common_1_1Resource_acdba916fa227bef4391c469581844dc6}{tesseract\_common::Resource::Ptr}} \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}},}
\DoxyCodeLine{423                                                        Eigen::Vector3d \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}} = Eigen::Vector3d(1, 1, 1),}
\DoxyCodeLine{424                                                        \textcolor{keywordtype}{bool} triangulate = \textcolor{keyword}{false},}
\DoxyCodeLine{425                                                        \textcolor{keywordtype}{bool} flatten = \textcolor{keyword}{false},}
\DoxyCodeLine{426                                                        \textcolor{keywordtype}{bool} normals = \textcolor{keyword}{false},}
\DoxyCodeLine{427                                                        \textcolor{keywordtype}{bool} vertex\_colors = \textcolor{keyword}{false},}
\DoxyCodeLine{428                                                        \textcolor{keywordtype}{bool} material\_and\_texture = \textcolor{keyword}{false})}
\DoxyCodeLine{429 \{}
\DoxyCodeLine{430   \textcolor{keywordflow}{if} (!\mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}})}
\DoxyCodeLine{431     \textcolor{keywordflow}{return} std::vector<std::shared\_ptr<T>>();}
\DoxyCodeLine{432 }
\DoxyCodeLine{433   \textcolor{keyword}{const} \textcolor{keywordtype}{char}* hint = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{434   std::string hint\_storage;}
\DoxyCodeLine{435 }
\DoxyCodeLine{436   std::string resource\_url = \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>getUrl();}
\DoxyCodeLine{437   std::regex hint\_re(\textcolor{stringliteral}{"{}\string^.*\(\backslash\)\(\backslash\).([A-\/Za-\/z0-\/9]\{1,8\})\$"{}});}
\DoxyCodeLine{438   std::smatch hint\_match;}
\DoxyCodeLine{439   \textcolor{keywordflow}{if} (std::regex\_match(resource\_url, hint\_match, hint\_re))}
\DoxyCodeLine{440   \{}
\DoxyCodeLine{441     \textcolor{keywordflow}{if} (hint\_match.size() == 2)}
\DoxyCodeLine{442     \{}
\DoxyCodeLine{443       hint\_storage = hint\_match[1].str();}
\DoxyCodeLine{444       hint = hint\_storage.c\_str();}
\DoxyCodeLine{445     \}}
\DoxyCodeLine{446   \}}
\DoxyCodeLine{447 }
\DoxyCodeLine{448   std::vector<uint8\_t> \mbox{\hyperlink{collision__margin__data__unit_8cpp_a0992235f6cab11fba6116193c7f42b8b}{data}} = \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>getResourceContents();}
\DoxyCodeLine{449   \textcolor{keywordflow}{if} (\mbox{\hyperlink{collision__margin__data__unit_8cpp_a0992235f6cab11fba6116193c7f42b8b}{data}}.empty())}
\DoxyCodeLine{450   \{}
\DoxyCodeLine{451     \textcolor{keywordflow}{if} (\mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>isFile())}
\DoxyCodeLine{452       \textcolor{keywordflow}{return} createMeshFromPath<T>(}
\DoxyCodeLine{453           \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>getFilePath(), \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}, triangulate, flatten, normals, vertex\_colors, material\_and\_texture);}
\DoxyCodeLine{454 }
\DoxyCodeLine{455     \textcolor{keywordflow}{return} std::vector<std::shared\_ptr<T>>();}
\DoxyCodeLine{456   \}}
\DoxyCodeLine{457 }
\DoxyCodeLine{458   \textcolor{comment}{// Create an instance of the Importer class}}
\DoxyCodeLine{459   Assimp::Importer importer;}
\DoxyCodeLine{460 }
\DoxyCodeLine{461   \textcolor{comment}{// Issue \#38 fix: as part of the post-\/processing, we remove all other components in file but}}
\DoxyCodeLine{462   \textcolor{comment}{// the meshes, as anyway the resulting shapes:Mesh object just receives vertices and triangles.}}
\DoxyCodeLine{463   \textcolor{comment}{// John Wason Jan 2021 -\/ Adjust flags based on normals, vertex\_colors, and material\_and\_texture parameters}}
\DoxyCodeLine{464   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ai\_config\_pp\_rcv\_flags = aiComponent\_TANGENTS\_AND\_BITANGENTS | aiComponent\_BONEWEIGHTS |}
\DoxyCodeLine{465                                         aiComponent\_ANIMATIONS | aiComponent\_LIGHTS | aiComponent\_CAMERAS;}
\DoxyCodeLine{466   \textcolor{keywordflow}{if} (!normals)}
\DoxyCodeLine{467   \{}
\DoxyCodeLine{468     ai\_config\_pp\_rcv\_flags |= aiComponent\_NORMALS;}
\DoxyCodeLine{469   \}}
\DoxyCodeLine{470   \textcolor{keywordflow}{if} (!vertex\_colors)}
\DoxyCodeLine{471   \{}
\DoxyCodeLine{472     ai\_config\_pp\_rcv\_flags |= aiComponent\_COLORS;}
\DoxyCodeLine{473   \}}
\DoxyCodeLine{474   \textcolor{keywordflow}{if} (!material\_and\_texture)}
\DoxyCodeLine{475   \{}
\DoxyCodeLine{476     ai\_config\_pp\_rcv\_flags |= aiComponent\_TEXCOORDS | aiComponent\_TEXTURES | aiComponent\_MATERIALS;}
\DoxyCodeLine{477   \}}
\DoxyCodeLine{478   importer.SetPropertyInteger(AI\_CONFIG\_PP\_RVC\_FLAGS, (\textcolor{keywordtype}{int})ai\_config\_pp\_rcv\_flags);}
\DoxyCodeLine{479 }
\DoxyCodeLine{480   \textcolor{comment}{// And have it read the given file with some post-\/processing}}
\DoxyCodeLine{481   \textcolor{keyword}{const} aiScene* scene = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{482   \textcolor{keywordflow}{if} (triangulate)}
\DoxyCodeLine{483     scene = importer.ReadFileFromMemory(\mbox{\hyperlink{collision__margin__data__unit_8cpp_a0992235f6cab11fba6116193c7f42b8b}{data}}.data(),}
\DoxyCodeLine{484                                         \mbox{\hyperlink{collision__margin__data__unit_8cpp_a0992235f6cab11fba6116193c7f42b8b}{data}}.size(),}
\DoxyCodeLine{485                                         aiProcess\_Triangulate | aiProcess\_JoinIdenticalVertices |}
\DoxyCodeLine{486                                             aiProcess\_SortByPType | aiProcess\_RemoveComponent,}
\DoxyCodeLine{487                                         hint);}
\DoxyCodeLine{488   \textcolor{keywordflow}{else}}
\DoxyCodeLine{489     scene =}
\DoxyCodeLine{490         importer.ReadFileFromMemory(\mbox{\hyperlink{collision__margin__data__unit_8cpp_a0992235f6cab11fba6116193c7f42b8b}{data}}.data(),}
\DoxyCodeLine{491                                     \mbox{\hyperlink{collision__margin__data__unit_8cpp_a0992235f6cab11fba6116193c7f42b8b}{data}}.size(),}
\DoxyCodeLine{492                                     aiProcess\_JoinIdenticalVertices | aiProcess\_SortByPType | aiProcess\_RemoveComponent,}
\DoxyCodeLine{493                                     hint);}
\DoxyCodeLine{494 }
\DoxyCodeLine{495   \textcolor{keywordflow}{if} (!scene)}
\DoxyCodeLine{496   \{}
\DoxyCodeLine{497     CONSOLE\_BRIDGE\_logError(}
\DoxyCodeLine{498         \textcolor{stringliteral}{"{}Could not load mesh from \(\backslash\)"{}\%s\(\backslash\)"{}: \%s"{}}, \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}-\/>getUrl().c\_str(), importer.GetErrorString());}
\DoxyCodeLine{499     \textcolor{keywordflow}{return} std::vector<std::shared\_ptr<T>>();}
\DoxyCodeLine{500   \}}
\DoxyCodeLine{501 }
\DoxyCodeLine{502   \textcolor{comment}{// Assimp enforces Y\_UP convention by rotating models with different conventions.}}
\DoxyCodeLine{503   \textcolor{comment}{// However, that behavior is confusing and doesn't match the ROS convention}}
\DoxyCodeLine{504   \textcolor{comment}{// where the Z axis is pointing up.}}
\DoxyCodeLine{505   \textcolor{comment}{// Hopefully this doesn't undo legit use of the root node transformation...}}
\DoxyCodeLine{506   \textcolor{comment}{// Note that this is also what RViz does internally.}}
\DoxyCodeLine{507   scene-\/>mRootNode-\/>mTransformation = aiMatrix4x4();}
\DoxyCodeLine{508 }
\DoxyCodeLine{509   \textcolor{keywordflow}{if} (flatten)}
\DoxyCodeLine{510   \{}
\DoxyCodeLine{511     \textcolor{comment}{// These post processing steps flatten the root node transformation into child nodes,}}
\DoxyCodeLine{512     \textcolor{comment}{// so they must be delayed until after clearing the root node transform above.}}
\DoxyCodeLine{513     importer.ApplyPostProcessing(aiProcess\_OptimizeMeshes | aiProcess\_OptimizeGraph);}
\DoxyCodeLine{514   \}}
\DoxyCodeLine{515   \textcolor{keywordflow}{else}}
\DoxyCodeLine{516   \{}
\DoxyCodeLine{517     importer.ApplyPostProcessing(aiProcess\_OptimizeGraph);}
\DoxyCodeLine{518   \}}
\DoxyCodeLine{519 }
\DoxyCodeLine{520   \textcolor{keywordflow}{return} createMeshFromAsset<T>(scene, \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}, \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}, normals, vertex\_colors, material\_and\_texture);}
\DoxyCodeLine{521 \}}
\DoxyCodeLine{522 }
\DoxyCodeLine{538 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{539 \textcolor{keyword}{static} std::vector<std::shared\_ptr<T>> \mbox{\hyperlink{namespacetesseract__geometry_a776ece4c5a30cc153042c0f13976f4f8}{createMeshFromBytes}}(\textcolor{keyword}{const} std::string\& url,}
\DoxyCodeLine{540                                                            \textcolor{keyword}{const} uint8\_t* bytes,}
\DoxyCodeLine{541                                                            \textcolor{keywordtype}{size\_t} bytes\_len,}
\DoxyCodeLine{542                                                            Eigen::Vector3d \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}} = Eigen::Vector3d(1, 1, 1),}
\DoxyCodeLine{543                                                            \textcolor{keywordtype}{bool} triangulate = \textcolor{keyword}{false},}
\DoxyCodeLine{544                                                            \textcolor{keywordtype}{bool} flatten = \textcolor{keyword}{false},}
\DoxyCodeLine{545                                                            \textcolor{keywordtype}{bool} normals = \textcolor{keyword}{false},}
\DoxyCodeLine{546                                                            \textcolor{keywordtype}{bool} vertex\_colors = \textcolor{keyword}{false},}
\DoxyCodeLine{547                                                            \textcolor{keywordtype}{bool} material\_and\_texture = \textcolor{keyword}{false})}
\DoxyCodeLine{548 \{}
\DoxyCodeLine{549   std::shared\_ptr<tesseract\_common::Resource> \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}} =}
\DoxyCodeLine{550       std::make\_shared<tesseract\_common::BytesResource>(url, bytes, bytes\_len);}
\DoxyCodeLine{551   \textcolor{keywordflow}{return} tesseract\_geometry::createMeshFromResource<T>(}
\DoxyCodeLine{552       \mbox{\hyperlink{resource__locator__unit_8cpp_acf8f69b40e998bd8f5330be6b90ab7dc}{resource}}, \mbox{\hyperlink{collision__margin__data__unit_8cpp_a80d402d10e8341004c0caf10133b80ab}{scale}}, triangulate, flatten, normals, vertex\_colors, material\_and\_texture);}
\DoxyCodeLine{553 \}}
\DoxyCodeLine{554 }
\DoxyCodeLine{555 \}  \textcolor{comment}{// namespace tesseract\_geometry}}
\DoxyCodeLine{556 }
\DoxyCodeLine{557 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
